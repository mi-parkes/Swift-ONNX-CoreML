# Swift-ONNX-CoreML

A Swift package for geospatial classification, leveraging **C++ interop**, **ONNX Runtime**, and **Core ML** for flexible model inference.

## Origin and Core Assets

This package was created by decoupling the core machine learning assets (**`GeoClassifier.mlmodelc`**, **`GeoClassifier.onnx`**, and **`GeoClassifierEvaluationData.json`**) and related classification functionality from the original repository, [mi-parkes/geo-coord-classifier](https://github.com/mi-parkes/geo-coord-classifier). This refactoring facilitates a **reusable Swift package** for integrating these models into various applications.

## Features

* **Swift–C++ Interoperability:** Seamlessly integrates high-performance C++ classification logic for native execution speed.

* **ONNX Runtime Integration:** Supports ONNX models via the [onnxruntime](https://onnxruntime.ai) binary dependency.

* **Core ML Integration:** Provides a pure-Swift classifier (`SwiftClassifier`) that dynamically loads `.mlmodelc` models at runtime, enabling direct use of Apple’s Core ML framework — no autogenerated Swift model code required.

* **Resource Bundling:** Includes necessary assets (ONNX or Core ML models, evaluation data) directly within the Swift package for clean deployment.

* **CLI Executable:** Offers a command-line tool (`testClassifier1`) for testing and evaluation on macOS.

## Requirements

* **Swift Toolchain:** Swift 6.1 or later  
* **Platforms:** macOS 15.0+ and iOS 16.0+  
* **C++ Standard:** Requires C++23 support (as defined in `Package.swift`)

* **ONNX Runtime:** The core library required for loading and running the ONNX model.
    * This project requires the **`onnxruntime.xcframework`** directory to be manually created and populated with header files and shared libraries (e.g., `libonnxruntime.1.23.0.dylib`) for **all platforms subject to build** (macOS, iOS, and iOS Simulator), as detailed in the [Building the Project](#building-the-project) section.
* **Model Files:**
    * `GeoClassifier.onnx`: The ONNX format of the quantized model.
    * `GeoClassifier.mlpackage`: The Core ML format of the model.
* **Evaluation Data:**
    * `GeoClassifierEvaluationData.json`: The data file used by the application to run automated, sequential evaluation on both the ONNX and Core ML backends.

-----

### Building the Project

<p align="center">
Swift-ONNX-CoreML Package Dependency Graph
<br><br>
<img src="doc/Swift-ONNX-CoreML.svg" 
    alt="something went wrong" width="90%">
</p>

The project expects the **`onnxruntime.xcframework`** directory to be located in the root directory of this project and contain the following structure:

```txt
/geo-coord-classifier
├── ...
├── geo-coord-classifier
├── geo-coord-classifier-cli
├── geo-coord-classifier.xcodeproj
├── ...
├── onnxruntime.xcframework
│   ├── Info.plist
│   ├── ios-arm64
│   │   ├── Headers
│   │   │   └── onnxruntime
│   │   └── libonnxruntime.1.23.0.dylib
│   ├── ios-arm64-simulator
│   │   ├── Headers
│   │   │   └── onnxruntime
│   │   └── libonnxruntime.1.23.0.dylib
│   └── macos-arm64
│       ├── Headers
│       │   └── onnxruntime
│       └── libonnxruntime.1.23.0.dylib
└── ...
```
#### Building from Command Line 🛠️

```bash
# Build CLI App for macOS
make build
```

## Installation

### Swift Package Manager (Recommended)

```swift
.package(url: "https://github.com/mi-parkes/Swift-ONNX-CoreML.git", from: "1.0.0")
```

